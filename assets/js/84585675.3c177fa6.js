"use strict";(self.webpackChunkOPS705=self.webpackChunkOPS705||[]).push([[408],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return d}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(a),d=r,h=c["".concat(s,".").concat(d)]||c[d]||m[d]||i;return a?n.createElement(h,o(o({ref:t},u),{},{components:a})):n.createElement(h,o({ref:t},u))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},2997:function(e,t,a){a.r(t),a.d(t,{assets:function(){return s},contentTitle:function(){return o},default:function(){return m},frontMatter:function(){return i},metadata:function(){return l},toc:function(){return p}});var n=a(3117),r=(a(7294),a(3905));const i={id:"lab2",title:"Lab 2",sidebar_position:2,description:"Lab 2 - Securing Your Virtual Machines"},o="Lab 2: Securing Your Virtual Machines",l={unversionedId:"Labs/lab2",id:"Labs/lab2",title:"Lab 2",description:"Lab 2 - Securing Your Virtual Machines",source:"@site/docs/Labs/lab2.md",sourceDirName:"Labs",slug:"/Labs/lab2",permalink:"/OPS705/Labs/lab2",draft:!1,editUrl:"https://github.com/Seneca-ICTOER/OPS705/tree/main/docs/Labs/lab2.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"lab2",title:"Lab 2",sidebar_position:2,description:"Lab 2 - Securing Your Virtual Machines"},sidebar:"courseNotesSidebar",previous:{title:"Lab 1",permalink:"/OPS705/Labs/lab1"},next:{title:"Lab 3",permalink:"/OPS705/Labs/lab3"}},s={},p=[{value:"Lab Preparation",id:"lab-preparation",level:2},{value:"Purpose / Objectives of Lab 2",id:"purpose--objectives-of-lab-2",level:3},{value:"Minimum Requirements",id:"minimum-requirements",level:3},{value:"Key Concepts",id:"key-concepts",level:2},{value:"Security: From the Beginning",id:"security-from-the-beginning",level:3},{value:"Firewalls",id:"firewalls",level:3},{value:"SSH Keypair Authentication",id:"ssh-keypair-authentication",level:3},{value:"Editing Text Files",id:"editing-text-files",level:3},{value:"Investigation 1:  Update Linux",id:"investigation-1--update-linux",level:2},{value:"Part 1: Privilege Escalation",id:"part-1-privilege-escalation",level:3},{value:"Using Sudo",id:"using-sudo",level:4},{value:"Part 2: Update CentOS",id:"part-2-update-centos",level:3},{value:"Investigation 2: Configuring Your Firewall",id:"investigation-2-configuring-your-firewall",level:2},{value:"Part 1: Replacing <em>firewalld</em> with <em>iptables</em>",id:"part-1-replacing-firewalld-with-iptables",level:3},{value:"Part 2: Securing Your Firewall",id:"part-2-securing-your-firewall",level:3},{value:"Investigation 3: Securing SSH",id:"investigation-3-securing-ssh",level:2},{value:"Part 1: Text Editing with <code>vim</code>",id:"part-1-text-editing-with-vim",level:3},{value:"Part 2: Adding a Custom Port to SELinux",id:"part-2-adding-a-custom-port-to-selinux",level:3},{value:"Part 3: Adding a Firewall Rule for the Custom SSH Port",id:"part-3-adding-a-firewall-rule-for-the-custom-ssh-port",level:3},{value:"Part 4: Modifying the SSH Service Listen Port",id:"part-4-modifying-the-ssh-service-listen-port",level:3},{value:"The Two-Terminal System",id:"the-two-terminal-system",level:4},{value:"SSH Listen Port",id:"ssh-listen-port",level:4},{value:"Part 5: Using SSH Keypairs",id:"part-5-using-ssh-keypairs",level:3},{value:"Switching to SSH keypair authentication:",id:"switching-to-ssh-keypair-authentication",level:4},{value:"Adding Your Professor&#39;s Public Key",id:"adding-your-professors-public-key",level:4},{value:"Disabling SSH password authentication:",id:"disabling-ssh-password-authentication",level:4},{value:"Investigation 4: Confirming Your Linux Work",id:"investigation-4-confirming-your-linux-work",level:2},{value:"Running a Shell Script to Check Your Work",id:"running-a-shell-script-to-check-your-work",level:3},{value:"Investigation 5: Updating Windows Server 2019",id:"investigation-5-updating-windows-server-2019",level:2},{value:"Part 1: Updating Windows with Artifacts",id:"part-1-updating-windows-with-artifacts",level:3},{value:"Lab Submission",id:"lab-submission",level:2}],u={toc:p};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"lab-2-securing-your-virtual-machines"},"Lab 2: Securing Your Virtual Machines"),(0,r.kt)("h2",{id:"lab-preparation"},"Lab Preparation"),(0,r.kt)("h3",{id:"purpose--objectives-of-lab-2"},"Purpose / Objectives of Lab 2"),(0,r.kt)("p",null,"In this lab, you will conduct several Linux system administration tasks to secure your system against would-be attackers and gain preliminary experience with the command line interface."),(0,r.kt)("p",null,"If you encounter technical issues, please contact your professor via e-mail or in your section's Microsoft Teams group."),(0,r.kt)("h3",{id:"minimum-requirements"},"Minimum Requirements"),(0,r.kt)("p",null,"Before beginning, you must have: "),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Successfully completed Lab 1."),(0,r.kt)("li",{parentName:"ol"},"Attended the Week 2 lecture"),(0,r.kt)("li",{parentName:"ol"},"Read through the Week 2 slides, and have them handy as a reference for concepts"),(0,r.kt)("li",{parentName:"ol"},"Your Seneca Azure login credentials"),(0,r.kt)("li",{parentName:"ol"},"Your linked mobile device for 2FA")),(0,r.kt)("h2",{id:"key-concepts"},"Key Concepts"),(0,r.kt)("h3",{id:"security-from-the-beginning"},"Security: From the Beginning"),(0,r.kt)("p",null,"In the not-too-distant past, companies would focus on getting their product and systems working and relegating security as their last step, often as an afterthought. When security is only considered at the end of a project, it's very difficult to remember all the ways in which your product interacts and things can get missed."),(0,r.kt)("p",null,"This created several high-profile breaches in the 90s and early 2000s, and our approach to security had to be reconsidered."),(0,r.kt)("p",null,"As a result, we now consider security ",(0,r.kt)("strong",{parentName:"p"},"from the beginning"),". As you create applications, add users to databases, create links between services, you ",(0,r.kt)("em",{parentName:"p"},"must")," keep security in mind at every step of development. Securing as you go is the best method, but even something as simple as simply documenting unsecured parts of your code as you go can be enough (assuming you go back and fix them!)"),(0,r.kt)("p",null,"Generally, we apply the concept of ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Principle_of_least_privilege"},"Principle of Least Privilege")," to security. Essentially, this boils down to locking everything down as much as possible and only allowing what and who you need through. Open access makes you a target. You'll be applying this principle to the firewall later in this lab."),(0,r.kt)("p",null,"We also take a look at defaults. Most systems and software come with pre-configured defaults to make out-of-the-box setup easy. This can take the form of a default username and password, default ports, etc. In a well secured system, these are often changed to avoid hack attempts. If you know the default, there's a high chance that hackers know it as well. You'll be changing some defaults in this lab."),(0,r.kt)("p",null,"This is not an exhaustive list of applied security, but it does give use a bit of working knowledge. You'll need it for this lab as well as in our AWS work."),(0,r.kt)("h3",{id:"firewalls"},"Firewalls"),(0,r.kt)("p",null,"In short, a firewall is a utility that sits on your computer between your network connection and the rest of your system."),(0,r.kt)("p",null,"Any application, services, or other data that is sent or received by your computer goes through your firewall first. The dominant network protocol is TCP/IP, which means we\u2019re dealing with packets. A firewall looks at these packets. To be clear, the firewall doesn\u2019t look inside packets, but just at the outside data like IP address and/or port destination, etc. The actual transmitted data is still secure and unread."),(0,r.kt)("p",null,"Generally with firewalls, we apply the ",(0,r.kt)("em",{parentName:"p"},"Principle of Least Privilege")," by dropping all new connections by default, and allowing a few exceptions. This is known as ",(0,r.kt)("strong",{parentName:"p"},"whitelisting"),"."),(0,r.kt)("h3",{id:"ssh-keypair-authentication"},"SSH Keypair Authentication"),(0,r.kt)("p",null,"When you connect to a computer with an SSH server, you\u2019re presented with a login screen. You are prompted for your username and password, and then allowed access if your credentials are correct. However, if your username and password are stolen (or guessed), someone else impersonating you can login. How do we prevent this?"),(0,r.kt)("p",null,"We use ",(0,r.kt)("strong",{parentName:"p"},"public")," and ",(0,r.kt)("strong",{parentName:"p"},"private")," keys to make users prove who they say they are."),(0,r.kt)("p",null,"This is known as public-key cryptography."),(0,r.kt)("p",null,"On your client machine, we generate a public/private key pair. Using cryptography, this method creates a public key and a private key. The public key is used to encrypt messages, and only the private key can decode them. We can then install the public key on our SSH server. This public key is used to uniquely identify your specific user on your specific client computer. With this method, you log in to the SSH server, the keys calculate your identity transparently, and you are logged on without having to provide a password."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Think of the public key like a lock you're installing on a door. Everyone can see this lock, it's public. But they can't open it."),(0,r.kt)("li",{parentName:"ul"},"Your private key is exactly that: a key. It's what's used to open that lock."),(0,r.kt)("li",{parentName:"ul"},"By installing your public key on your Linux VM, you are creating a secure lock that only you can open with your key.")),(0,r.kt)("p",null,"You'll create and install keys in this lab and later in our AWS labs as your only method to access those AWS VMs."),(0,r.kt)("h3",{id:"editing-text-files"},"Editing Text Files"),(0,r.kt)("p",null,"As you will be working in the Linux command line environment, it is useful to learn a least one common command-line text editors."),(0,r.kt)("p",null,"Although programmers and developers usually use graphical IDE's to code and compile programs (Visual Studio, Sublime, Eclipse, etc), they can create source code using a text editor and compile their code directly on the server to generate executable programs (without having to transfer them for compilation or execution)."),(0,r.kt)("p",null,'Developers very often use a text editor to modify configuration files. In this course, you will become familiar with the process of installing, configuring, and running network services. Text editors are an important tool to help this setup, but are also used to "tweak" or make periodic changes in service configurations.'),(0,r.kt)("p",null,"The two most readily-available command line text editors in Linux are ",(0,r.kt)("strong",{parentName:"p"},"nano")," and ",(0,r.kt)("strong",{parentName:"p"},"vi"),"."),(0,r.kt)("p",null,"The nano text editor would seem like an easier-to-use text editor, but vi (although taking longer to learn) has outstanding features and allow the user to be more productive with editing text files."),(0,r.kt)("h2",{id:"investigation-1--update-linux"},"Investigation 1:  Update Linux"),(0,r.kt)("p",null,"This investigation simply has you update your CentOS installation. This includes operating system packages, as well as any other packages that have been installed using yum."),(0,r.kt)("h3",{id:"part-1-privilege-escalation"},"Part 1: Privilege Escalation"),(0,r.kt)("p",null,"Updating the operating system, by its very nature, changes the system. ",(0,r.kt)("strong",{parentName:"p"},"Any command or utility that performs system-wide changes can only be run by a system administrator.")," Remember that."),(0,r.kt)("p",null,"To update the operating system, you'll need to have administrative access. There are two ways to do this:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"logging in to an admin account from your regular account"),(0,r.kt)("li",{parentName:"ol"},"running a command as your regular user with temporary admin powers")),(0,r.kt)("p",null,"We call this ",(0,r.kt)("em",{parentName:"p"},"privilege elevation")," or ",(0,r.kt)("em",{parentName:"p"},"elevating your privileges"),". Only regular user accounts that belong to the system's administrator group can do this. The name of the admin group changes depending on the distribution of Linux; for CentOS, it's the ",(0,r.kt)("strong",{parentName:"p"},"wheel")," group. The first user account you created as part of your VM installation was automatically added to this group as part of the Azure VM deployment process."),(0,r.kt)("p",null,"Let's go through a few examples."),(0,r.kt)("p",null,"First, let's login:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Start your Linux VM in Azure (this may take a few minutes)"),(0,r.kt)("li",{parentName:"ol"},"Connect to the VM remotely via SSH using your regular account. (Refer to Lab 1)")),(0,r.kt)("h4",{id:"using-sudo"},"Using Sudo"),(0,r.kt)("p",null,"We can run administration-level commands by using ",(0,r.kt)("strong",{parentName:"p"},"sudo"),". Sudo allows you to run a command as an administrator (root) from your standard account. For the duration of the command's run, you are root. When the command completes, you are back to being a regular user."),(0,r.kt)("p",null,"Normally, the shell environment will ask you for your account password as an extra security precaution when using sudo. However, cloud-based Linux VMs typically have ",(0,r.kt)("em",{parentName:"p"},"password-less sudo access"),". The idea is that identity management and security is handled by the cloud infrastructure. We'll explore that in detail later in the course."),(0,r.kt)("p",null,"(Image:Ops705_lab2_fig1.png - Figure 1: Example commands with sudo.)"),(0,r.kt)("p",null,"Run the following commands:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"whoami\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo whoami\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"whoami\n")))),(0,r.kt)("p",null,"The ",(0,r.kt)("em",{parentName:"p"},"whoami")," command responds by printing out your username. Notice how, by using the command in combination with ",(0,r.kt)("em",{parentName:"p"},"sudo"),", the response is ",(0,r.kt)("strong",{parentName:"p"},"root"),". While the second command is running, you are root. But the moment it ends, you drop back down to your standard user. This is why the third command responds with your standard user again."),(0,r.kt)("p",null,"Sudo is the preferred method of running admin-level commands, especially when you only have one command to run, or just a few. Only run commands with sudo that require it. Remember, the root user can do ",(0,r.kt)("strong",{parentName:"p"},"anything")," on the system, including accidentally delete all files. Only use it when you need it."),(0,r.kt)("p",null,"=== Logging Into Root ===\nTo run administration-level commands, we can also log into the root admin account from our standard user. This is primarily done when a user knows they'll be running many admin-level commands during a session to complete a task."),(0,r.kt)("p",null,"From your standard user, elevate to the root account with the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo su -\n")),(0,r.kt)("p",null,"Notice that your command prompt has immediately changed. It no longer prints out your username at the beginning of each line, but the name of the ",(0,r.kt)("strong",{parentName:"p"},"root")," account. This is a good visual aid to let you know how you're logged in."),(0,r.kt)("p",null,"[","[Image:Ops705_lab2_fig2.png|thumb|right|350px|Figure 2: Example commands as root.]","]\nRun the same commands from the sudo subsection:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"whoami\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo whoami\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"whoami\n")))),(0,r.kt)("p",null,"Notice that each command returns the output ",(0,r.kt)("strong",{parentName:"p"},"root"),". This is in contrast to using the sudo command from your regular user account. When you are logged into the root account directly as you are now, ",(0,r.kt)("strong",{parentName:"p"},"all commands you issue will run as root"),". Be very careful! With great power comes great responsibility."),(0,r.kt)("p",null,"To log out of root and drop back down to your regular user, run: ",(0,r.kt)("inlineCode",{parentName:"p"},"exit")),(0,r.kt)("h3",{id:"part-2-update-centos"},"Part 2: Update CentOS"),(0,r.kt)("p",null,"As mentioned in the Week 2 lecture, keeping your Linux system up to date is an incredibly important task and must be done regularly. You are the administrator of this system, you must keep it running well. While updating is a graded part of this lab, you should run the command again regularly to check for new updates while you continue to work with this virtual machine over the next several weeks."),(0,r.kt)("p",null,"(Image:Ops705_lab2_fig3.png - Figure 3: A yum update in progress.)"),(0,r.kt)("p",null,"Run the command to update CentOS:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo yum update\n")),(0,r.kt)("p",null,"Running this as a regular user will give you an error, which is why you temporarily elevate your privileges for the duration of a command with sudo."),(0,r.kt)("p",null,"There will likely be further user interaction for this update command, mostly asking you to confirm an action. For updates, you can type ",(0,r.kt)("inlineCode",{parentName:"p"},"y")," and hit Enter safely. That said, do get in the habit of reading warnings and when it asks for your confirmation."),(0,r.kt)("p",null,"The update command will look for updates, download the install files, and then update the system. Most updates don't require a restart (unlike Windows!), except for kernel updates. The kernel is the very basic building block of the system; sort of the heart. It's responsible for many of the most basic functions a computer performs. If a kernel update is installed, you need to restart the system to use the new kernel. As this is your first update, you'll likely have a kernel upgrade installed."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"When the yum update command completes, restart the system with the following command:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo reboot\n")))),(0,r.kt)("p",null,"You'll be disconnected from your remote session as the SSH server inside your VM shuts down along with the rest of the system."),(0,r.kt)("p",null,"It may take a few minutes for the VM to restart. You can track its progress through the Azure DTL Overview page. Once back up and running, log back in to confirm everything still works."),(0,r.kt)("h2",{id:"investigation-2-configuring-your-firewall"},"Investigation 2: Configuring Your Firewall"),(0,r.kt)("p",null,"In this investigation, you'll replace the default firewall with another and follow security best practices in constructing your firewall rules."),(0,r.kt)("h3",{id:"part-1-replacing-firewalld-with-iptables"},"Part 1: Replacing ",(0,r.kt)("em",{parentName:"h3"},"firewalld")," with ",(0,r.kt)("em",{parentName:"h3"},"iptables")),(0,r.kt)("p",null,"(Image:Ops705_lab2_fig16.png - Figure 4: Service status of both firewalls.)\n(Image:Ops705_lab2_fig4.png - Figure 5: Default iptables firewall rules.)"),(0,r.kt)("p",null,"The default firewall for CentOS, ",(0,r.kt)("em",{parentName:"p"},"firewalld")," is more complex than we need. We'll be reverting to the easier to use ",(0,r.kt)("em",{parentName:"p"},"iptables")," standard. This will require the removal of the ",(0,r.kt)("em",{parentName:"p"},"firewalld")," package, the installation of the ",(0,r.kt)("em",{parentName:"p"},"iptables-services")," package, and working with systemd services to turn on your new firewall."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Make sure you follow these instructions in order. If you don't, you may be locked out of your Linux VM forever.")," If you encounter errors on any step, stop and ask for help. Do not continue!"),(0,r.kt)("p",null,"As we are going to run several admin-level commands, we will log in as root for this section:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"From your regular user, elevate to the root account:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo su -\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Install the ",(0,r.kt)("em",{parentName:"p"},"iptables-services")," firewall package:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum install iptables-services\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Stop the ",(0,r.kt)("em",{parentName:"p"},"firewalld")," service and start the ",(0,r.kt)("em",{parentName:"p"},"iptables")," service in a single, chained command:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl stop firewalld; systemctl start iptables\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Check the status of the ",(0,r.kt)("em",{parentName:"p"},"firewalld")," service. It should tell you it's stopped:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl status -l firewalld\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Check the status of the ",(0,r.kt)("em",{parentName:"p"},"iptables")," service. It should tell you it's ",(0,r.kt)("strong",{parentName:"p"},"active"),": "),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl status -l iptables\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"View your current ",(0,r.kt)("em",{parentName:"p"},"iptables")," firewall rules:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L -vn --line-numbers\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Refer to ",(0,r.kt)("em",{parentName:"p"},"Figure 5"),". If your rules at this stage look different, stop and contact your professor for help. (Values in the ",(0,r.kt)("strong",{parentName:"p"},"pkts")," and ",(0,r.kt)("strong",{parentName:"p"},"bytes")," column may vary.)")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Set the ",(0,r.kt)("em",{parentName:"p"},"iptables")," firewall to start with the system:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl enable iptables\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Remove ",(0,r.kt)("em",{parentName:"p"},"firewalld")," completely, including all unused files:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum autoremove firewalld\n")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"(",(0,r.kt)("strong",{parentName:"li"},"Note:")," If you don't remove ",(0,r.kt)("em",{parentName:"li"},"firewalld")," and both firewalls are set to start with the system, ",(0,r.kt)("em",{parentName:"li"},"firewalld")," will always start instead of iptables. This can lead to much frustration. Make sure you remove it!)")),(0,r.kt)("h3",{id:"part-2-securing-your-firewall"},"Part 2: Securing Your Firewall"),(0,r.kt)("p",null,"There are a few standard security practices to follow when dealing with firewalls. In this section, we will changes our firewall rules to follow those practices. For more detail, refer to the Week 2 lecture and material."),(0,r.kt)("p",null,"(Image:Ops705_lab2_fig15.png - Figure 6: Modified iptables firewall rules.)"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Set your default policy for the INPUT chain to DROP:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -P INPUT DROP\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Remove the reject rule from the INPUT chain to hide our server from scans:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -D INPUT 5\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Set your default policy for the FORWARD chain to DROP:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -P FORWARD DROP\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Remove the reject rule from the FORWARD chain to hide it from scans:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -D FORWARD 1\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Verify your changes by running the list rules command again (Refer to ",(0,r.kt)("em",{parentName:"p"},"Fig. 6")," as a reference):"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -nvL --line\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"To confirm you haven't locked yourself out, log out of SSH and log back in. If you don't encounter any login issues, you're good to go.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Assuming the step above works"),", in your Linux VM, save your rule changes:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"service iptables save\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Congratulations, you've secured your firewall!")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Drop back down to your regular user at this point, you never want to stay logged in as root: ",(0,r.kt)("inlineCode",{parentName:"p"},"exit")))),(0,r.kt)("h2",{id:"investigation-3-securing-ssh"},"Investigation 3: Securing SSH"),(0,r.kt)("p",null,"In this investigation, you will be editing configuration text files to change the port the SSH service listens on. You will be using the ",(0,r.kt)("strong",{parentName:"p"},"vim")," utility to make some of these changes."),(0,r.kt)("h3",{id:"part-1-text-editing-with-vim"},"Part 1: Text Editing with ",(0,r.kt)("inlineCode",{parentName:"h3"},"vim")),(0,r.kt)("p",null,'(Image:vi-text-editor-2.png - Figure 7: The online vi-tutorial provides users "hands-on" experience of using the vi text editor.)'),(0,r.kt)("p",null,"You will now learn basic editing skills using the vi (vim) text editor including creating, editing, and saving text files. As mentioned, the vim text editor (although taking longer to learn) has outstanding features to increase coding productivity."),(0,r.kt)("p",null,"(",(0,r.kt)("inlineCode",{parentName:"p"},"vim")," is a newer version of vi with expanded features. We will be using vim in this course. In most cases, ",(0,r.kt)("em",{parentName:"p"},"vi")," and ",(0,r.kt)("em",{parentName:"p"},"vim")," can be used interchangeably here.)"),(0,r.kt)("p",null,"The big thing to remember with vim is that it starts in ",(0,r.kt)("strong",{parentName:"p"},"COMMAND")," mode. You need to issue letter commands to change modes (including to enter plain text into the document). Also, you can press colon \u201c: \u201d in COMMAND mode to enter more complex commands."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Resource:")," ",(0,r.kt)("a",{parentName:"p",href:"https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/04650c56-ae63-4c1c-8f3c-0cb5f38ebb6b/vi-help-sheet-011.pdf"},"vi Cheat Sheet (PDF)")),(0,r.kt)("p",null,'An interactive tutorial has been created to give you "hands-on" experience on how to use vi text editor. It is recommended that you run this interactive tutorial in your Linux account to learn how to create and edit text files with the vi text editor.'),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Run the interactive tutorial from your CentOS command line:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"vi-tutorial\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},'In the tutorial menu, select the first menu item labelled "USING THE VI TEXT EDITOR"')),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},'Read and follow the instructions in the tutorial. Eventually, it will display a simulated vi environment and will provide you with "hands-on" practice using the vi text editor.')),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"When you have completed that section, you will be returned to the main menu.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},'If you want to get extra practice, you can select the menu item labelled "REVIEW EXERCISE".')),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"When you want to exit the tutorial, select the menu option to exit the tutorial."))),(0,r.kt)("p",null,"(Image:vi-text-editor-b.png - Figure 8: Contents of ",(0,r.kt)("em",{parentName:"p"},"othertext.txt"),")"),(0,r.kt)("p",null,"After you have completed the tutorial:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Using ",(0,r.kt)("inlineCode",{parentName:"p"},"vim"),", create a new text file called ",(0,r.kt)("em",{parentName:"p"},"othertext.txt")," in your home directory with these two commands one at a time:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ~\nvim othertext.txt\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Write the text shown in ",(0,r.kt)("em",{parentName:"p"},"Figure 8")," to your new ",(0,r.kt)("em",{parentName:"p"},"othertext.txt")," file, save, and quit.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Confirm the contents of your text file match ",(0,r.kt)("em",{parentName:"p"},"Figure 8"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cat othertext.txt\n")))),(0,r.kt)("p",null,"You can also ",(0,r.kt)("strong",{parentName:"p"},"manage"),", ",(0,r.kt)("strong",{parentName:"p"},"view")," or ",(0,r.kt)("strong",{parentName:"p"},"manipulate the display")," of text files. This is HIGHLY ADVISED in case you only want to view contents and ",(0,r.kt)("strong",{parentName:"p"},"NOT")," edit text file contents which can cause accidental erasure of data."),(0,r.kt)("p",null,"Refer to the following table of Text File Management Commands:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Linux Command"),(0,r.kt)("th",{parentName:"tr",align:null},"Purpose"),(0,r.kt)("th",{parentName:"tr",align:null},"Example"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"touch"),(0,r.kt)("td",{parentName:"tr",align:null},"Create empty file(s) / Updates Existing File's Date/Time Stamp"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"touch otherfile.txt"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"cat"),(0,r.kt)("td",{parentName:"tr",align:null},"Display text file's contents without editing (small files)"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cat otherfile.txt"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"more, less"),(0,r.kt)("td",{parentName:"tr",align:null},"Display / Navigate within large text files without editing"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"less otherfile.txt"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"cp"),(0,r.kt)("td",{parentName:"tr",align:null},"Copy text file(s)"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cp otherfile.txt uli101xx/otherfile.txt"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"mv"),(0,r.kt)("td",{parentName:"tr",align:null},"Move / Rename text files"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"mv otherfile.txt uli101xx/otherfile.txt"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"rm"),(0,r.kt)("td",{parentName:"tr",align:null},"Remove text file(s)"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"rm otherfile.txt"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"sort"),(0,r.kt)("td",{parentName:"tr",align:null},"Sorts (rearranges) order of file contents when displayed. Content is sorted alphabetically by default. The -n option sorts numerically, -r performs a reverse sort"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"sort otherfile.txt"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"head"),(0,r.kt)("td",{parentName:"tr",align:null},"Displays the ",(0,r.kt)("strong",{parentName:"td"},"first")," 10 lines of a text file by default. An option using a number value will display that number of lines (e.g. ",(0,r.kt)("inlineCode",{parentName:"td"},"head -5 filename")," will display first 5 lines)."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"head -2 otherfile.txt"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"tail"),(0,r.kt)("td",{parentName:"tr",align:null},"Displays the ",(0,r.kt)("strong",{parentName:"td"},"last")," 10 lines of a text file by default. An option using a number value will display that number of lines (e.g. ",(0,r.kt)("inlineCode",{parentName:"td"},"tail -5 filename")," will display last 5 lines)."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"tail -2 otherfile.txt"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"grep"),(0,r.kt)("td",{parentName:"tr",align:null},"Displays file contents that match a pattern"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},'grep "third" otherfile.txt'))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"uniq"),(0,r.kt)("td",{parentName:"tr",align:null},"Displays identical consecutive lines only once"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"uniq otherfile.txt"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"diff file1 file2"),(0,r.kt)("td",{parentName:"tr",align:null},"Displays differences between 2 files"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"diff otherfile.txt otherfile2.txt"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"file"),(0,r.kt)("td",{parentName:"tr",align:null},"Gives info about the contents of the file (e.g. file with no extension)."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"file othertext.txt"))))),(0,r.kt)("h3",{id:"part-2-adding-a-custom-port-to-selinux"},"Part 2: Adding a Custom Port to SELinux"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"SELinux")," is an extra security system that looks for unusual patterns of behaviour in programs. While SELinux is a large topic of its own, we will only work with it briefly here. In this part, we will tell SELinux it's alright for it to allow SSH connections on a custom port."),(0,r.kt)("p",null,"The default is port ",(0,r.kt)("strong",{parentName:"p"},"22"),", we will be changing it to ",(0,r.kt)("strong",{parentName:"p"},"22222"),"."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Run the following command (it will several seconds to complete):"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo semanage port -a -t ssh_port_t -p tcp 22222\n")))),(0,r.kt)("h3",{id:"part-3-adding-a-firewall-rule-for-the-custom-ssh-port"},"Part 3: Adding a Firewall Rule for the Custom SSH Port"),(0,r.kt)("p",null,"(Image:Ops705_sshd_custom_rule.png - Figure 9: Adding a firewall rule for our new SSH custom port.)"),(0,r.kt)("p",null,"As mentioned, we want to change what port the system uses to allow incoming SSH connections. To do that, we have to add an extra rule to our firewall to allow it through:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Review your current rules for reference:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo iptables -nvL --line\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add a new rule to our firewall for port 22222: "),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo iptables -A INPUT -p tcp --dport 22222 -j ACCEPT\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Confirm your new rule has been added: "),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo iptables -nvL --line\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"If it has, save your new rules: "),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo service iptables save\n")))),(0,r.kt)("h3",{id:"part-4-modifying-the-ssh-service-listen-port"},"Part 4: Modifying the SSH Service Listen Port"),(0,r.kt)("p",null,"(Admon/caution - WARNING: Failure to follow the steps in Part 4 ",(0,r.kt)("em",{parentName:"p"},"properly and carefully")," will result in losing access to your Linux VM.|If that happens, you\u2019ll need to delete the VM and recreate it.)"),(0,r.kt)("p",null,"In this section, you will change what port the SSH service listens on for new connections."),(0,r.kt)("h4",{id:"the-two-terminal-system"},"The Two-Terminal System"),(0,r.kt)("p",null,"When working with cloud-based systems, your remote connection to the system must be protected at all costs. If you make a change that removes your ability to connect, this is usually ",(0,r.kt)("strong",{parentName:"p"},"permanent"),". This includes anything that changes your network, firewall, and SSH service. Careless modifications can result in a total loss of access. In these cases, the only way to recover is to delete the entire VM and start from scratch."),(0,r.kt)("p",null,"Luckily, most of these fatal mistakes only affect ",(0,r.kt)("em",{parentName:"p"},"new")," remote connections. While you're still connected you can still fix your mistakes."),(0,r.kt)("p",null,"Whenever you are modifying any of these (as you will below), you should use the Two-Terminal System. This involves opening two separate remote SSH terminals to your Linux system:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Control Terminal"),": This is the terminal you use to make changes to the system. ",(0,r.kt)("em",{parentName:"li"},"Do not log out of this terminal.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Testing Terminal"),": This is the terminal you use to test your ability to reconnect after you make a change. Log out and log back in. If you're unable to log back in, you've broken something. Use your Control Terminal to find the problem and fix it. Continue using your Testing Terminal to log back in as you fix problems and make changes.")),(0,r.kt)("p",null,"Make sure to follow this method during ",(0,r.kt)("em",{parentName:"p"},"Investigation 2")," and ",(0,r.kt)("em",{parentName:"p"},"Investigation 3"),"."),(0,r.kt)("h4",{id:"ssh-listen-port"},"SSH Listen Port"),(0,r.kt)("p",null,"(Image:Ops705_sshd_listenport_custom.png - Figure 10: Setting the custom listen port for SSHd.)"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Using vim, open the SSH configuration file:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo vim /etc/ssh/sshd_config\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Find the line (near the top) containing the words: ",(0,r.kt)("inlineCode",{parentName:"p"},"Port 22"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Change this line to read: ",(0,r.kt)("inlineCode",{parentName:"p"},"Port 22222"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Save and quit vim.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Restart the sshd service:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl restart sshd\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Check the status of the service:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl status -l sshd\n")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"WARNING: If the status is in a ",(0,r.kt)("em",{parentName:"strong"},"Failed")," state, retrace your steps.")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Look back at the SSHd config file for typos."),(0,r.kt)("li",{parentName:"ul"},"Did you forget to run the ",(0,r.kt)("inlineCode",{parentName:"li"},"semanage")," command from Investigation 3, Part 2?")),(0,r.kt)("p",{parentName:"li"},"Restart the SSHd service to apply additional changes ",(0,r.kt)("strong",{parentName:"p"},"and check its status again."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"If the status is ",(0,r.kt)("strong",{parentName:"p"},"active (running)"),", move onto the next step.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In your ",(0,r.kt)("strong",{parentName:"p"},"test terminal"),", disconnect from your SSH connection and reconnect ",(0,r.kt)("strong",{parentName:"p"},"using the new port 22222"),". "),(0,r.kt)("p",{parentName:"li"},"Example:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ssh -p 22222 yourSenecaUsername@address\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"If you're able to reconnect, move on to the next step."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"WARNING: If you can't reconnect, use your control terminal window to find any mistakes you may have made.")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"Remember, don't disconnect from your control terminal until you're sure you can reconnect!")," Use as many test terminal windows as you need.")))),(0,r.kt)("h3",{id:"part-5-using-ssh-keypairs"},"Part 5: Using SSH Keypairs"),(0,r.kt)("p",null,"(Admon/caution - WARNING: Failure to follow the steps in Part 5 ",(0,r.kt)("em",{parentName:"p"},"properly and carefully")," will result in losing access to your Linux VM.|If that happens, you\u2019ll need to delete the VM and recreate it.)"),(0,r.kt)("p",null,"In Part 5, you will generate an SSH keypair on your Linux VM, install them, and then copy your keys onto your personal computer to allow you to authenticate to your VM securely going forward when connecting."),(0,r.kt)("h4",{id:"switching-to-ssh-keypair-authentication"},"Switching to SSH keypair authentication:"),(0,r.kt)("p",null,"(Image:Ops705_filezilla-connect.png - Figure 11: Connection information for FileZilla using the custom port.)"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"First, download and install the FileZilla Client software on your personal computer.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"On your Linux VM as a regular user, generate your SSH keypair (accept all defaults):"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ssh-keygen\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Install the new keys on the system: "),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ssh-copy-id -p 22222 localhost\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Using FileZilla on your ",(0,r.kt)("strong",{parentName:"p"},"personal computer"),", log into the Linux VM and find your new public and private keys. They can be found on your Linux VM here:  "),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Private Key"),": ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.ssh/id_rsa"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Public Key"),": ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.ssh/id_rsa.pub"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Download these keys to your personal computer with FileZilla:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"On Windows"),", store the downloaded key here: ",(0,r.kt)("inlineCode",{parentName:"p"},"C:\\Users\\[youruser]\\.ssh\\"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"On macOS"),", store the downloaded key here: ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.ssh/"),", then run the following commands in macOS Terminal:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"chmod 700 ~/.ssh; chmod 600 ~/.ssh/id_rsa\n"))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"With a second terminal, verify that you can login to your VM's SSH from your personal computer without a password (keypair authentication). Do not move on to the next step until you\u2019re sure."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Login the same way as before. ",(0,r.kt)("strong",{parentName:"li"},"If you aren't asked for a password, then keypair authentication has succeeded.")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Save both keys (",(0,r.kt)("inlineCode",{parentName:"p"},"id_rsa")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"id_rsa.pub"),") to secondary, portable location. This can be online storage like OneDrive or Dropbox, or to a USB drive. You will need your keys when you come to class to log in to your Linux VM going forward."))),(0,r.kt)("h4",{id:"adding-your-professors-public-key"},"Adding Your Professor's Public Key"),(0,r.kt)("p",null,"In this section, you will add your professor's public key to allow them to log in to your Linux VM and run lab checks and perform troubleshooting when needed."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Confirm you have the file:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cat ~/bin/professorID.pub\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Using the following command as your ",(0,r.kt)("strong",{parentName:"p"},"regular user"),", install your professor's public key on to your Linux VM:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cat ~/bin/professorID.pub >> ~/.ssh/authorized_keys\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"On your test terminal, log out and log back in again to check that keypair authentication is still working. If it isn't, backtrack your steps and fix the issue!"))),(0,r.kt)("h4",{id:"disabling-ssh-password-authentication"},"Disabling SSH password authentication:"),(0,r.kt)("p",null,"(Image:Ops705_sshd_passauth_no.png - Figure 12: Disabling password-based authentication in SSHd.)"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Make sure you have two SSH separate terminals connected to you Azure Linux VM.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In your control terminal, use ",(0,r.kt)("inlineCode",{parentName:"p"},"vim")," to open the SSH configuration file:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo vim /etc/ssh/sshd_config\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Find the line that contains ",(0,r.kt)("em",{parentName:"p"},"PasswordAuthentication"),", remove the # symbol at the beginning of the line, and change the yes into a ",(0,r.kt)("strong",{parentName:"p"},"no"),". It should look like this:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-text"},"PasswordAuthentication no\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Save and quit vim.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Restart the sshd service:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl restart sshd\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Check the status of the service:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl status -l sshd\n")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"If the status is in a ",(0,r.kt)("em",{parentName:"strong"},"Failed")," state, retrace your steps.")," Look back at the SSHd config file for typos. Redo the last two steps to apply additional changes.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"If the status is ",(0,r.kt)("strong",{parentName:"p"},"active (running)"),", move onto the next step.")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In your ",(0,r.kt)("strong",{parentName:"p"},"test terminal"),", disconnect from your SSH connection and reconnect."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"If you can to reconnect, move on to the next step.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"If you ",(0,r.kt)("em",{parentName:"strong"},"can't")," reconnect, use your control terminal window to find any mistakes you may have made.")," Remember, don't disconnect from your control terminal until you're sure you can reconnect! Use as many test terminal windows as you need."))))),(0,r.kt)("h2",{id:"investigation-4-confirming-your-linux-work"},"Investigation 4: Confirming Your Linux Work"),(0,r.kt)("p",null,"(Image:script-check-lab2.png - If all checks pass, then user performed task correctly and can continue.)"),(0,r.kt)("h3",{id:"running-a-shell-script-to-check-your-work"},"Running a Shell Script to Check Your Work"),(0,r.kt)("p",null,"Although you have been double-checking your work (right?), you ",(0,r.kt)("em",{parentName:"p"},"might")," have made some mistakes."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Forgetting to enable ",(0,r.kt)("inlineCode",{parentName:"li"},"iptables"),"."),(0,r.kt)("li",{parentName:"ul"},"Missing a firewall rule."),(0,r.kt)("li",{parentName:"ul"},"Forgetting to update Linux.")),(0,r.kt)("p",null,"To check for mistakes, a ",(0,r.kt)("strong",{parentName:"p"},"shell script")," has been created to check your work for you. "),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"If the checking shell script detects an error"),", then it will tell you and offer constructive feedback on how to fix that problem so you can re-run the checking shell scripts until your work is correct."),(0,r.kt)("p",null,"Perform the following steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Change directories to ~/bin: ",(0,r.kt)("inlineCode",{parentName:"li"},"cd ~/bin")),(0,r.kt)("li",{parentName:"ol"},"Make sure you have the most recent lab files: ",(0,r.kt)("inlineCode",{parentName:"li"},"git pull")),(0,r.kt)("li",{parentName:"ol"},"Change back to your home directory: ",(0,r.kt)("inlineCode",{parentName:"li"},"cd ~")),(0,r.kt)("li",{parentName:"ol"},"Run the checking script for your Linux work in this lab: ",(0,r.kt)("inlineCode",{parentName:"li"},"labcheck2.sh")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"If you encounter errors:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Review the feedback."),(0,r.kt)("li",{parentName:"ul"},"Make the necessary corrections."),(0,r.kt)("li",{parentName:"ul"},"Re-run the checking script."))),(0,r.kt)("li",{parentName:"ol"},"If all checks pass (with the congratulations message), take a screenshot of the ",(0,r.kt)("strong",{parentName:"li"},"full script output")," (don't leave any text out or cut off). You'll need it for later.")),(0,r.kt)("h2",{id:"investigation-5-updating-windows-server-2019"},"Investigation 5: Updating Windows Server 2019"),(0,r.kt)("p",null,"Updating your Windows Server VM in Azure is a little bit easier. It takes advantage of the cloud infrastructure to allow point-and-click updates."),(0,r.kt)("h3",{id:"part-1-updating-windows-with-artifacts"},"Part 1: Updating Windows with Artifacts"),(0,r.kt)("p",null,"(Image:Ops705_artifacts1.jpg - Figure 13: Adding artifacts to your Windows VM in Azure.)"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Spin up your Windows Server VM, and wait until it's fully started up."),(0,r.kt)("li",{parentName:"ol"},"In the Azure blade for your Windows Server VM, click on the ",(0,r.kt)("strong",{parentName:"li"},"Manage artifacts")," item in the menu bar to the left."),(0,r.kt)("li",{parentName:"ol"},"In this new window, click on the ",(0,r.kt)("strong",{parentName:"li"},"Apply artifacts")," button. This will bring you to the ",(0,r.kt)("em",{parentName:"li"},"Add artifacts")," screen."),(0,r.kt)("li",{parentName:"ol"},"In the ",(0,r.kt)("em",{parentName:"li"},"Add artifacts")," search field, type ",(0,r.kt)("strong",{parentName:"li"},"Time"),"."),(0,r.kt)("li",{parentName:"ol"},"Click on ",(0,r.kt)("strong",{parentName:"li"},"Set Time Zone")," in the results listing, then click ",(0,r.kt)("strong",{parentName:"li"},"Add")," in the next window."),(0,r.kt)("li",{parentName:"ol"},"You'll be returned to the ",(0,r.kt)("em",{parentName:"li"},"Add artifacts")," window."),(0,r.kt)("li",{parentName:"ol"},"Add the following additional artifacts:",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Firefox"),(0,r.kt)("li",{parentName:"ol"},"Windows Firewall operations \u2013 Enable ICMP (Ping)"),(0,r.kt)("li",{parentName:"ol"},"Installs the latest Windows Updates"))),(0,r.kt)("li",{parentName:"ol"},"You'll be returned to the ",(0,r.kt)("em",{parentName:"li"},"Add artifacts")," window. Simply click ",(0,r.kt)("strong",{parentName:"li"},"OK")," to install them."),(0,r.kt)("li",{parentName:"ol"},"The ",(0,r.kt)("em",{parentName:"li"},"Manage Artifacts")," window will return, and a new entry for each artifact will appear. Their statuses will cycle through ",(0,r.kt)("em",{parentName:"li"},"Pending"),", ",(0,r.kt)("em",{parentName:"li"},"Installing"),", and finally ",(0,r.kt)("em",{parentName:"li"},"Succeeded"),"."),(0,r.kt)("li",{parentName:"ol"},"When all artifacts are in a ",(0,r.kt)("em",{parentName:"li"},"Succeeded")," state, move to Part 2. (This may take 10-20 minutes.)")),(0,r.kt)("h2",{id:"lab-submission"},"Lab Submission"),(0,r.kt)("p",null,"Submit to Blackboard ",(0,r.kt)("strong",{parentName:"p"},"full-desktop")," screenshots (PNG/JPG) of the following:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Results of a successful run of ",(0,r.kt)("inlineCode",{parentName:"li"},"labcheck2.sh"),"."),(0,r.kt)("li",{parentName:"ol"},"Logging in to your Linux VM without a password on port ",(0,r.kt)("strong",{parentName:"li"},"22222"),"."),(0,r.kt)("li",{parentName:"ol"},"Run the ",(0,r.kt)("inlineCode",{parentName:"li"},"yum update")," command to show there are no further updates to install and screenshot the result."),(0,r.kt)("li",{parentName:"ol"},"Service status of ",(0,r.kt)("em",{parentName:"li"},"firewalld")," and ",(0,r.kt)("em",{parentName:"li"},"iptables"),"."),(0,r.kt)("li",{parentName:"ol"},"Listing of your modified firewall rules."),(0,r.kt)("li",{parentName:"ol"},"A full view of the contents of your ",(0,r.kt)("strong",{parentName:"li"},"othertext.txt")," file."),(0,r.kt)("li",{parentName:"ol"},"A full view of the contents of ",(0,r.kt)("strong",{parentName:"li"},"~/.ssh/authorized_keys"),"."),(0,r.kt)("li",{parentName:"ol"},"Listing of your applied artifacts in Azure for your Windows Server VM.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Reminder:")," Make sure to fully stop your VMs when you're done!"))}m.isMDXComponent=!0}}]);